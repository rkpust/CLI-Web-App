<!-- v1.1 -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="csrf-token" content="">
        {% csrf_token %}
        <title>CLI Web App</title>
        
        <style>
            /* Reset some default styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
    
            /* Body settings */
            body {
                font-family: 'monospace'; /* Monospaced font */
                background-color: #1e1e1e;  /* Dark background */
                color: #ffffff; /* Green text */
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                font-size: 14px;
            }
    
            /* Terminal container */
            .terminal {
                width: 80%;
                max-width: 900px;
                height: 70%;
                background-color: #000000; /* Black background */
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0, 255, 0, 0.3); /* Green shadow */
                color: #ffffff;
                overflow-y: auto;
            }
    
            /* Output container (where the command output will appear) */
            .output {
                white-space: pre-wrap;
                margin-bottom: 20px;
            }
    
            /* Each line of output (to simulate terminal lines) */
            .line {
                margin: 5px 0;
            }
    
            /* Input area */
            .input-line {
                display: flex;
                align-items: center;
            }
    
            /* The prompt symbol (>) */
            .prompt {
                margin-right: 10px;
            }
    
            /* The input field */
            .input {
                width: 100%;
                background: transparent;
                border: none;
                color: #ffffff;
                font-size: 14px;
                outline: none;
                caret-color: #ffffff;
            }
    
            /* Add a blinking cursor effect */
            .input:focus {
                animation: blink 1s step-end infinite;
            }
    
            /* Blinking cursor animation */
            @keyframes blink {
                50% {
                    border-color: transparent;
                }
                100% {
                    border-color: #00ff00;
                }
            }
        </style>
    </head>
    

    <body>
        <div class="terminal">
            <div>CLI Web Application [Version 1.1]<br>(c) Rezaul Karim. All rights reserved.</div>
            <div class="output">

            </div>
            <div class="input-line">
                <span class="prompt">>></span>
                <input type="text" class="input" id="cli-input" autofocus/>
            </div>
        </div>


    <script>
        document.getElementById('cli-input').addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                const userInput = e.target.value.trim();
                if (userInput) {
                    const outputDiv = document.querySelector('.output');
                    const newLine = document.createElement('div');
                    newLine.classList.add('line');
                    newLine.textContent = `>> ${userInput}`;
                    
                    const csrfToken = document.querySelector('[name=csrf-token]').content;
                    // Send the userInput to Django backend using fetch
                    fetch('/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken  // Add the CSRF token here
                        },
                        body: JSON.stringify({ userInput: userInput })  // Send userInput as JSON
                    })
                    .then(response => response.json())  // Parse the response JSON
                    .then(data => {
                        const responseLine = document.createElement('div');
                        responseLine.classList.add('line');
                        if (data.response) {
                            responseLine.textContent = data.response;  // Use the response from Django
                        } else if (data.error) {
                            responseLine.textContent = `Error: ${data.error}`;  // Display error message if any
                        }
        
                        // Append user input and response
                        outputDiv.appendChild(newLine);
                        outputDiv.appendChild(responseLine);
                        e.target.value = '';  // Clear the input field
                        outputDiv.scrollTop = outputDiv.scrollHeight;  // Auto scroll to the bottom
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const responseLine = document.createElement('div');
                        responseLine.classList.add('line');
                        responseLine.textContent = 'Error communicating with server';
                        outputDiv.appendChild(newLine);
                        outputDiv.appendChild(responseLine);
                        e.target.value = ''; // Clear the input field
                    });
                }
                e.preventDefault();  // Prevent form submission or other actions
            }
        });
        </script>
    </body>
</html>